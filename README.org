#+TITLE: My NixOS Configuration
#+AUTHOR: Rob Alicea
#+DESCRIPTION: A personal NixOS setup managed with Flakes, featuring Hyprland and Home Manager.

* Overview
This repository contains my personal NixOS configuration, managed declaratively using [[https://nixos.wiki/wiki/Flakes][Nix Flakes]]. It sets up a complete desktop environment based on the [[https://hyprland.org/][Hyprland]] Wayland compositor and manages user-specific dotfiles with [[https://github.com/nix-community/home-manager][Home Manager]].

* üìÇ Structure
The configuration is broken down into several files and directories for better organization:
- =flake.nix=: The entry point for the entire configuration. It defines the inputs (Nixpkgs, Home Manager) and the main outputs (the NixOS system).
- =configuration.nix=: The main system-wide configuration file. It imports all other system modules.
- =home.nix=: The main user-specific configuration file, managed by Home Manager. It defines dotfiles, user packages, and services.
- =modules/=: Contains modularized parts of the configuration (e.g., Hyprland, Waybar).
- =nixos-modules/=: Contains modularized parts of the main NixOS system configuration (e.g., hardware, networking).

* üöÄ Deployment
To deploy this configuration on a new machine, follow these general steps.

** 1. Initial NixOS Installation
Boot from a NixOS installer USB drive and connect to the internet.

** 2. Partitioning
Partition your disks as desired. For this guide, we'll assume you have mounted your root partition to =/mnt= and your boot partition to =/mnt/boot=.

** 3. Clone the Repository
Clone this repository into the =/mnt/etc/nixos= directory.
#+begin_src bash
git clone https://github.com/newtolinux23/Dotfiles.git /mnt/etc/nixos
#+end_src

** 4. Generate Hardware Configuration
Generate an initial hardware configuration file. This will be imported by the main configuration.
#+begin_src bash
nixos-generate-config --root /mnt
# You can now copy the generated hardware-configuration.nix to the repository
cp /mnt/etc/nixos/hardware-configuration.nix /mnt/etc/nixos/Dotfiles/
# Note: The repository already contains a hardware-configuration.nix, you may need to adapt it.
#+end_src

** 5. Build the System
Now, build the system using the flake. The hostname for the system defined in the flake is =nixos=.
#+begin_src bash
nixos-install --flake /mnt/etc/nixos#nixos
#+end_src
After installation, reboot the system.

* üîê Managing Secrets
This configuration uses some services that require secret keys (e.g., a WireGuard VPN). The parts of the configuration that require secrets have been commented out to make the public repository safe and portable.

The original configuration had a hardcoded path to a private key:
=/home/rob/private.key=

This is not a secure or reproducible practice. To manage secrets correctly, you should use a dedicated tool like:
- [[https://github.com/Mic92/sops-nix][sops-nix]] (recommended)
- [[https://github.com/ryantm/agenix][agenix]]

These tools allow you to encrypt your secrets and safely store them within this repository. You can then uncomment the relevant services and point them to the decrypted secret files provided by these tools.

* ‚ú® Customization
To customize this configuration, you can edit the =.nix= files and rebuild the system:
#+begin_src bash
# From within the /etc/nixos directory
sudo nixos-rebuild switch --flake .#nixos
#+end_src